#!/usr/bin/env python
import time
import sys
import threading
import subprocess
import shlex

from pcaspy import Driver, SimpleServer

prefix = ''
pvdb = { 
    'Bpm:1-P11': {},
    'Bpm:2-P11': {},
    'Bpm:3-P11': {},
    'Bpm:4-P11': {},
    'Bpm:5-P11': {},
    'Bpm:6-P11': {},
    'Bpm:7-P11': {},
    'Bpm:8-P11': {},
    'Bpm:9-P11': {},
    'Bpm:10-P11': {},
    'Bpm:11-P11': {},
    'Bpm:12-P11': {},
    'Bpm:13-P11': {},
    'Bpm:14-P11': {},
    'Bpm:15-P11': {},
    'Bpm:16-P11': {},
    'Bpm:17-P11': {},
    'Bpm:18-P11': {},
    'Bpm:19-P11': {},
    'Bpm:20-P11': {},
    'Bpm:21-P11': {},
    'Bpm:22-P11': {},
    'Bpm:23-P11': {},
    'Bpm:24-P11': {},
    'Bpm:25-P11': {},
    'Bpm:26-P11': {},
    'Bpm:1-X11': {},
    'Bpm:2-X11': {},
    'Bpm:3-X11': {},
    'Bpm:4-X11': {},
    'Bpm:5-X11': {},
    'Bpm:6-X11': {},
    'Bpm:7-X11': {},
    'Bpm:8-X11': {},
    'Bpm:9-X11': {},
    'Bpm:10-X11': {},
    'Bpm:11-X11': {},
    'Bpm:12-X11': {},
    'Bpm:13-X11': {},
    'Bpm:14-X11': {},
    'Bpm:15-X11': {},
    'Bpm:16-X11': {},
    'Bpm:17-X11': {},
    'Bpm:18-X11': {},
    'Bpm:19-X11': {},
    'Bpm:20-X11': {},
    'Bpm:21-X11': {},
    'Bpm:22-X11': {},
    'Bpm:23-X11': {},
    'Bpm:24-X11': {},
    'Bpm:25-X11': {},
    'Bpm:26-X11': {},
    'Bpm:1-Y11': {},
    'Bpm:2-Y11': {},
    'Bpm:3-Y11': {},
    'Bpm:4-Y11': {},
    'Bpm:5-Y11': {},
    'Bpm:6-Y11': {},
    'Bpm:7-Y11': {},
    'Bpm:8-Y11': {},
    'Bpm:9-Y11': {},
    'Bpm:10-Y11': {},
    'Bpm:11-Y11': {},
    'Bpm:12-Y11': {},
    'Bpm:13-Y11': {},
    'Bpm:14-Y11': {},
    'Bpm:15-Y11': {},
    'Bpm:16-Y11': {},
    'Bpm:17-Y11': {},
    'Bpm:18-Y11': {},
    'Bpm:19-Y11': {},
    'Bpm:20-Y11': {},
    'Bpm:21-Y11': {},
    'Bpm:22-Y11': {},
    'Bpm:23-Y11': {},
    'Bpm:24-Y11': {},
    'Bpm:25-Y11': {},
    'Bpm:26-Y11': {},
    'SCRF:CAV1:EPIC': {},
    'SCRF:CAV2:EPIC': {},
    'SCRF:CAV3:EPIC': {},
    'SCRF:CAV4:EPIC': {},
    'SCRF:CAV5:EPIC': {},
    'SCRF:CAV6:EPIC': {},
    'SCRF:CAV7:EPIC': {},
    'SCRF:CAV8:EPIC': {},
    'SCRF:CAV9:EPIC': {},
    'SCRF:CAV10:EPIC': {},
    'SCRF:CAV11:EPIC': {},
    'SCRF:CAV12:EPIC': {},
    'SCRF:CAV13:EPIC': {},
    'SCRF:CAV14:EPIC': {},
    'SCRF:CAV15:EPIC': {},
    'SCRF:CAV16:EPIC': {},
    'SCRF:CAV17:EPIC': {},
    'SCRF:CAV18:EPIC': {},
    'SCRF:CAV19:EPIC': {},
    'SCRF:CAV20:EPIC': {},
    'SCRF:CAV21:EPIC': {},
    'SCRF:CAV22:EPIC': {},
    'SCRF:CAV23:EPIC': {},
    'LLRF:Buncher1:Cavity_AMP': {},
    'LLRF:Buncher2:Cavity_AMP': {},
    'SCRF:CAV1:PHASE:READ': {},
    'SCRF:CAV2:PHASE:READ': {},
    'SCRF:CAV3:PHASE:READ': {},
    'SCRF:CAV4:PHASE:READ': {},
    'SCRF:CAV5:PHASE:READ': {},
    'SCRF:CAV6:PHASE:READ': {},
    'SCRF:CAV7:PHASE:READ': {},
    'SCRF:CAV8:PHASE:READ': {},
    'SCRF:CAV9:PHASE:READ': {},
    'SCRF:CAV10:PHASE:READ': {},
    'SCRF:CAV11:PHASE:READ': {},
    'SCRF:CAV12:PHASE:READ': {},
    'SCRF:CAV13:PHASE:READ': {},
    'SCRF:CAV14:PHASE:READ': {},
    'SCRF:CAV15:PHASE:READ': {},
    'SCRF:CAV16:PHASE:READ': {},
    'SCRF:CAV17:PHASE:READ': {},
    'SCRF:CAV18:PHASE:READ': {},
    'SCRF:CAV19:PHASE:READ': {},
    'SCRF:CAV20:PHASE:READ': {},
    'SCRF:CAV21:PHASE:READ': {},
    'SCRF:CAV22:PHASE:READ': {},
    'SCRF:CAV23:PHASE:READ': {},
    'LLRF:Buncher1:Cavity_PHASE': {},
    'LLRF:Buncher2:Cavity_PHASE': {},
    'HCM1_PS:SOL_01:IMon': {},
    'HCM1_PS:SOL_02:IMon': {},
    'HCM1_PS:SOL_03:IMon': {},
    'HCM1_PS:SOL_04:IMon': {},
    'HCM1_PS:SOL_05:IMon': {},
    'HCM1_PS:SOL_06:IMon': {},
    'HCM1_PS:DCH_01:IMon': {},
    'HCM1_PS:DCH_02:IMon': {},
    'HCM1_PS:DCH_03:IMon': {},
    'HCM1_PS:DCH_04:IMon': {},
    'HCM1_PS:DCH_05:IMon': {},
    'HCM1_PS:DCH_06:IMon': {},
    'HCM1_PS:DCV_01:IMon': {},
    'HCM1_PS:DCV_02:IMon': {},
    'HCM1_PS:DCV_03:IMon': {},
    'HCM1_PS:DCV_04:IMon': {},
    'HCM1_PS:DCV_05:IMon': {},
    'HCM1_PS:DCV_06:IMon': {},
    'HCM2_PS:SOL_01:IMon': {},
    'HCM2_PS:SOL_02:IMon': {},
    'HCM2_PS:SOL_03:IMon': {},
    'HCM2_PS:SOL_04:IMon': {},
    'HCM2_PS:SOL_05:IMon': {},
    'HCM2_PS:SOL_06:IMon': {},
    'HCM2_PS:DCH_01:IMon': {},
    'HCM2_PS:DCH_02:IMon': {},
    'HCM2_PS:DCH_03:IMon': {},
    'HCM2_PS:DCH_04:IMon': {},
    'HCM2_PS:DCH_05:IMon': {},
    'HCM2_PS:DCH_06:IMon': {},
    'HCM2_PS:DCV_01:IMon': {},
    'HCM2_PS:DCV_02:IMon': {},
    'HCM2_PS:DCV_03:IMon': {},
    'HCM2_PS:DCV_04:IMon': {},
    'HCM2_PS:DCV_05:IMon': {},
    'HCM2_PS:DCV_06:IMon': {},
    'HCM3_PS:SOL_01:IMon': {},
    'HCM3_PS:SOL_02:IMon': {},
    'HCM3_PS:SOL_03:IMon': {},
    'HCM3_PS:SOL_04:IMon': {},
    'HCM3_PS:SOL_05:IMon': {},
    'HCM3_PS:SOL_06:IMon': {},
    'HCM3_PS:DCH_01:IMon': {},
    'HCM3_PS:DCH_02:IMon': {},
    'HCM3_PS:DCH_03:IMon': {},
    'HCM3_PS:DCH_04:IMon': {},
    'HCM3_PS:DCH_05:IMon': {},
    'HCM3_PS:DCH_06:IMon': {},
    'HCM3_PS:DCV_01:IMon': {},
    'HCM3_PS:DCV_02:IMon': {},
    'HCM3_PS:DCV_03:IMon': {},
    'HCM3_PS:DCV_04:IMon': {},
    'HCM3_PS:DCV_05:IMon': {},
    'HCM3_PS:DCV_06:IMon': {},
    'HCM4_PS:SOL_01:IMon': {},
    'HCM4_PS:SOL_02:IMon': {},
    'HCM4_PS:SOL_03:IMon': {},
    'HCM4_PS:SOL_04:IMon': {},
    'HCM4_PS:SOL_05:IMon': {},
    'HCM4_PS:DCH_01:IMon': {},
    'HCM4_PS:DCH_02:IMon': {},
    'HCM4_PS:DCH_03:IMon': {},
    'HCM4_PS:DCH_04:IMon': {},
    'HCM4_PS:DCH_05:IMon': {},
    'HCM4_PS:DCV_01:IMon': {},
    'HCM4_PS:DCV_02:IMon': {},
    'HCM4_PS:DCV_03:IMon': {},
    'HCM4_PS:DCV_04:IMon': {},
    'HCM4_PS:DCV_05:IMon': {},
    'MEBT_PS:QUAD_01:IMon': {},
    'MEBT_PS:QUAD_02:IMon': {},
    'MEBT_PS:QUAD_03:IMon': {},
    'MEBT_PS:QUAD_05:IMon': {},
    'MEBT_PS:QUAD_06:IMon': {},
    'MEBT_PS:QUAD_07:IMon': {},
    'MEBT_PS:DCH_01:IMon': {},
    'MEBT_PS:DCH_02:IMon': {},
    'MEBT_PS:DCH_03:IMon': {},
    'MEBT_PS:DCH_04:IMon': {},
    'MEBT_PS:DCH_05:IMon': {},
    'MEBT_PS:DCH_06:IMon': {},
    'MEBT_PS:DCH_07:IMon': {},
    'MEBT_PS:DCV_01:IMon': {},
    'MEBT_PS:DCV_02:IMon': {},
    'MEBT_PS:DCV_03:IMon': {},
    'MEBT_PS:DCV_04:IMon': {},
    'MEBT_PS:DCV_05:IMon': {},
    'MEBT_PS:DCV_06:IMon': {},
    'MEBT_PS:DCV_07:IMon': {},
    'HEBT_PS:QUAD_01:IMon': {},
    'HEBT_PS:QUAD_02:IMon': {},
    'HEBT_PS:DCH_01:IMon': {},
    'HEBT_PS:DCH_02:IMon': {},
    'HEBT_PS:DCV_01:IMon': {},
    'HEBT_PS:DCV_02:IMon': {},
    'LEBT_BD:FC_01:In': {},
    'ADS:ACCT1': {},
    'ADS:ACCT2': {},
    'ADS:ACCT3': {},
    'ADS:ACCT4': {},
    'ADS:DUTYFACTOR': {},
    'LEBT_PS:SOL_01:IMon': {},
    'ADS:G2:MC': {},
    'ADS:G3:MC': {},
    'LEBT_PS:DCH_01:IMon': {},
    'LEBT_PS:DCH_02:IMon': {},
    'LEBT_PS:DCV_01:IMon': {},
    'LEBT_PS:DCV_02:IMon': {}
}



class myDriver(Driver):
    def __init__(self):
        Driver.__init__(self)

    def write(self, reason, value):
        status = True
        # take proper actions
        self.setParam(reason, value)
        return status

if __name__ == '__main__':
    server = SimpleServer()
    server.createPV(prefix, pvdb)

    driver = myDriver()

    while True:
        # process CA transactions
        server.process(0.01)
